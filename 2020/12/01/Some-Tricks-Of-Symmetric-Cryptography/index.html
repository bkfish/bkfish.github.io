<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Symmetric Cryptography means this encryption algorithm use the same key for encryption and decryption. Although I am a web dog, encryption algorithm in some web question recently let me broken heart.">
<meta property="og:type" content="article">
<meta property="og:title" content="Some Tricks of Symmetric Cryptography">
<meta property="og:url" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/index.html">
<meta property="og:site_name" content="书鱼">
<meta property="og:description" content="Symmetric Cryptography means this encryption algorithm use the same key for encryption and decryption. Although I am a web dog, encryption algorithm in some web question recently let me broken heart.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/1.png">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/2.png">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/3.png">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/4.png">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/1.jpg">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/5.png">
<meta property="article:published_time" content="2020-12-01T06:05:08.000Z">
<meta property="article:modified_time" content="2020-12-09T21:10:52.000Z">
<meta property="article:author" content="Bkfish">
<meta property="article:tag" content="crypto">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Some Tricks of Symmetric Cryptography</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2020/12/01/Some-Php-Pop-Chain-Analysis/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2020/10/04/%E5%BA%9F%E7%89%A9%E5%88%A9%E7%94%A8%E4%B9%8B%E5%88%A9%E7%94%A8%E4%B8%80%E5%8F%B0%E5%BA%9F%E5%BC%83%E7%AC%94%E8%AE%B0%E6%9C%AC%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BACTF%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%9F%BA%E7%A1%80%E5%BB%BA%E8%AE%BE/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&text=Some Tricks of Symmetric Cryptography"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&title=Some Tricks of Symmetric Cryptography"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&is_video=false&description=Some Tricks of Symmetric Cryptography"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Some Tricks of Symmetric Cryptography&body=Check out this article: http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&title=Some Tricks of Symmetric Cryptography"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&title=Some Tricks of Symmetric Cryptography"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&title=Some Tricks of Symmetric Cryptography"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&title=Some Tricks of Symmetric Cryptography"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&name=Some Tricks of Symmetric Cryptography&description=&lt;p&gt;Symmetric Cryptography means this encryption algorithm use the same key for encryption and decryption. Although I am a web dog, encryption algorithm in some web question recently let me broken heart.&lt;/p&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&t=Some Tricks of Symmetric Cryptography"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Some-Symmetric-Encryption-Algorithm"><span class="toc-number">1.</span> <span class="toc-text">1. Some Symmetric Encryption Algorithm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Symmetric-Cryptography-in-CTF-WEB"><span class="toc-number">2.</span> <span class="toc-text">2. Symmetric Cryptography in CTF-WEB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Some-Encryption-mode"><span class="toc-number">3.</span> <span class="toc-text">3. Some Encryption mode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Electronic-Codebook-Book-ECB"><span class="toc-number">3.1.</span> <span class="toc-text">3.1. Electronic Codebook Book (ECB)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Cipher-Block-Chaining-CBC"><span class="toc-number">3.2.</span> <span class="toc-text">3.2. Cipher Block Chaining (CBC)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-CBC-Byte-Flipping-Attack"><span class="toc-number">4.</span> <span class="toc-text">4.CBC Byte Flipping Attack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-Working-Principle"><span class="toc-number">4.1.</span> <span class="toc-text">4.1.Working Principle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-For-example-if-we-can-change-iv"><span class="toc-number">4.2.</span> <span class="toc-text">4.2.For example if we can change iv</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-Question-of-only-change-iv"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.2.1.Question of only change iv</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-change-cipher-iv"><span class="toc-number">4.3.</span> <span class="toc-text">4.3.change cipher&amp;&amp;iv</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-CBC-Padding-Oracle"><span class="toc-number">5.</span> <span class="toc-text">5.CBC Padding Oracle</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Q"><span class="toc-number">5.1.</span> <span class="toc-text">5.1.Q</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Some Tricks of Symmetric Cryptography
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Bkfish</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-12-01T06:05:08.000Z" class="dt-published" itemprop="datePublished">2020-12-01</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/crypto/" rel="tag">crypto</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>Symmetric Cryptography means this encryption algorithm use the same key for encryption and decryption. Although I am a web dog, encryption algorithm in some web question recently let me broken heart.</p>
<span id="more"></span>

<!-- toc -->

<h2 id="1-Some-Symmetric-Encryption-Algorithm"><a href="#1-Some-Symmetric-Encryption-Algorithm" class="headerlink" title="1. Some Symmetric Encryption Algorithm"></a>1. Some Symmetric Encryption Algorithm</h2><p>DES、3DES、TDEA、Blowfish、RC2、RC4、RC5、IDEA、SKIPJACK</p>
<p>Here is another blog for <a href="/2019/08/16/S-DES%E8%AF%A6%E8%A7%A3/">S-DES</a> which i wrote before.</p>
<h2 id="2-Symmetric-Cryptography-in-CTF-WEB"><a href="#2-Symmetric-Cryptography-in-CTF-WEB" class="headerlink" title="2. Symmetric Cryptography in CTF-WEB"></a>2. Symmetric Cryptography in CTF-WEB</h2><p>here are some crypto in ctf.which i know most is Padding Oracle or Cbc Flipped Ciphertext Bits.<br>for example CBC in NJCTF or <a target="_blank" rel="noopener" href="http://ctf5.shiyanbar.com/web/jiandan/test.php">shiyanba easy login question</a> and so on . some i want introduce some Padding Oracle Tricks in ctf_web.</p>
<h2 id="3-Some-Encryption-mode"><a href="#3-Some-Encryption-mode" class="headerlink" title="3. Some Encryption mode"></a>3. Some Encryption mode</h2><p>Symmetric encryption has two types of encryption modes, namely block encryption and stream encryption.but in AES algorithm has five modes.if you want to find a aes decrypto&#x2F;encrypto online mabey you need choice which mode you want use.<br>for example<br><img src="/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/1.png"></p>
<blockquote>
<p>Electronic Codebook Book (ECB)<br>Cipher Block Chaining (CBC)<br>Counter (CTR)<br>Cipher FeedBack (CFB)<br>Output FeedBack (OFB)</p>
</blockquote>
<h3 id="3-1-Electronic-Codebook-Book-ECB"><a href="#3-1-Electronic-Codebook-Book-ECB" class="headerlink" title="3.1. Electronic Codebook Book (ECB)"></a>3.1. Electronic Codebook Book (ECB)</h3><p>ECB is the simplest mode is encryption modes.<br><img src="/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/2.png"><br>As we can see,we just need block the plaintext.Encryto every piece,than split joint every ciphertext.this is ECB encryption mode.</p>
<h3 id="3-2-Cipher-Block-Chaining-CBC"><a href="#3-2-Cipher-Block-Chaining-CBC" class="headerlink" title="3.2. Cipher Block Chaining (CBC)"></a>3.2. Cipher Block Chaining (CBC)</h3><p>In this mode, the plaintext is first divided into several segments, and then each segment is XOR with the initial block(first segments) or the ciphertext segment of the previous segment, and then encrypted with the key.<br><img src="/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/3.png"><br>Explain this encryption flow chart:<br>• Ciphertext-0 &#x3D; Encrypt(Plaintext XOR IV)—for first plaintext segment<br>• Ciphertext-N&#x3D; Encrypt(Plaintext XOR Ciphertext-N-1)—othere plaintext segments<br>Decyption as same.<br><img src="/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/4.png"><br>•Plaintext-0 &#x3D; Decrypt(Ciphertext XOR IV) —for first ciphertext segment<br>•Plaintext-N&#x3D; Decrypt(Ciphertext XOR Ciphertext-N-1)—othere ciphertext segments</p>
<h2 id="4-CBC-Byte-Flipping-Attack"><a href="#4-CBC-Byte-Flipping-Attack" class="headerlink" title="4.CBC Byte Flipping Attack"></a>4.CBC Byte Flipping Attack</h2><p>Purpose of CBC Byte Flipping Attack:To change a byte in the plaintext by corrupting a byte in the ciphertext.</p>
<h3 id="4-1-Working-Principle"><a href="#4-1-Working-Principle" class="headerlink" title="4.1.Working Principle"></a>4.1.Working Principle</h3><p>Note: The Ciphertext-N-1 is used to generate the plaintext of the next block; this is where the byte flipping attack comes into play. If we change one byte of the Ciphertext-N-1 then, by XORing with the net decrypted block, we will get a different plaintext! You got it? Do not worry, we will see a detailed example below. Meanwhile, below is a nice diagram explaining this attack<br><img src="/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/1.jpg"><br>And this is we know in math</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Now_Plantext(A) = Now_Ciphertext(B) ^ Last_Ciphertext(C)</span><br><span class="line">A = B ^ C</span><br><span class="line">A ^ A = 0;   0 ^ A = A</span><br><span class="line">C = A ^ A ^ C = B ^ C ^ A ^ C = A ^ B</span><br><span class="line">ascii(&#x27;a&#x27;) ^ C ^ A ^ B = ascii(&#x27;a&#x27;) ^ A ^ B ^ A ^ B = ascii(&#x27;a&#x27;) ^ 0 = ascii(&#x27;a&#x27;)</span><br></pre></td></tr></table></figure>
<p>so if we want let answer become “a”,we just need <code> Last_Ciphertext ^ Now_Plantext ^ Now_Ciphertext ^ &quot;A&quot;</code></p>
<h3 id="4-2-For-example-if-we-can-change-iv"><a href="#4-2-For-example-if-we-can-change-iv" class="headerlink" title="4.2.For example if we can change iv"></a>4.2.For example if we can change iv</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KEY = &#x27;mHAxsLYz&#x27;</span><br><span class="line">vi = &quot;qwerasdf&quot;</span><br><span class="line">admin-&gt;bdmin</span><br></pre></td></tr></table></figure>
<p>This env len(vi&#x3D;&#x3D;Key),so we just need <code> new_cipher=bytes([ord(chr(cipher[0]))^ord(&#39;a&#39;)^ord(&#39;b&#39;)])+cipher[1:]</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyDes <span class="keyword">import</span> des, CBC, PAD_PKCS5</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">KEY = <span class="string">&#x27;mHAxsLYz&#x27;</span></span><br><span class="line">vi = <span class="string">&quot;qwerasdf&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_encrypt</span>(<span class="params">s</span>):</span><br><span class="line">    secret_key = KEY</span><br><span class="line">    iv = vi</span><br><span class="line">    k = des(secret_key, CBC, iv, pad=<span class="literal">None</span>, padmode=PAD_PKCS5)</span><br><span class="line">    en = k.encrypt(s, padmode=PAD_PKCS5)</span><br><span class="line">    <span class="keyword">return</span> binascii.b2a_hex(en)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_descrypt</span>(<span class="params">s,iv</span>):</span><br><span class="line">    secret_key = KEY</span><br><span class="line">    iv = iv</span><br><span class="line">    k = des(secret_key, CBC, iv, pad=<span class="literal">None</span>, padmode=PAD_PKCS5)</span><br><span class="line">    de = k.decrypt(binascii.a2b_hex(s), padmode=PAD_PKCS5)</span><br><span class="line">    <span class="keyword">return</span> de</span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = des_encrypt(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">cipher = <span class="built_in">bytes</span>(vi,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(cipher)</span><br><span class="line">x = <span class="built_in">bytes</span>([<span class="built_in">ord</span>(<span class="built_in">chr</span>(cipher[<span class="number">0</span>]))^<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)^<span class="built_in">ord</span>(<span class="string">&#x27;b&#x27;</span>)])+cipher[<span class="number">1</span>:]</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line">str3 = des_descrypt(<span class="built_in">str</span>,x)</span><br><span class="line"><span class="built_in">print</span>(str3)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/5.png"><br>In php we use those func for cbc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);</span><br><span class="line">openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)</span><br></pre></td></tr></table></figure>
<h4 id="4-2-1-Question-of-only-change-iv"><a href="#4-2-1-Question-of-only-change-iv" class="headerlink" title="4.2.1.Question of only change iv"></a>4.2.1.Question of only change iv</h4><p>source_code</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;METHOD&quot;</span>, <span class="string">&quot;aes-128-cbc&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;SECRET_KEY&quot;</span>, <span class="string">&quot;XXXXX&quot;</span>);</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;flag&#123;this_is_flag&#125;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_random_token</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$random_token</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">16</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="variable">$random_token</span>.=<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$random_token</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_identity</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="variable">$defaultID</span> = <span class="string">&quot;heheda&quot;</span>;</span><br><span class="line"> <span class="variable">$token</span> = <span class="title function_ invoke__">get_random_token</span>();</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$defaultID</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$token</span>));</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;token&quot;</span>, <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$token</span>));</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;isadmin&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_admin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$token</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;token&#x27;</span>]);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$id</span> = <span class="title function_ invoke__">openssl_decrypt</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>]), METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$token</span>))&#123;</span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$id</span> == <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;isadmin&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="keyword">die</span>(<span class="string">&quot;Error!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">    <span class="title function_ invoke__">get_identity</span>();</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="title function_ invoke__">is_admin</span>();</span><br><span class="line"> <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&quot;isadmin&quot;</span>])&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&quot;You are admin!\n&quot;</span>;</span><br><span class="line">     <span class="keyword">die</span>(<span class="variable">$flag</span>);</span><br><span class="line"> &#125;<span class="keyword">else</span></span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&quot;You are not admin!\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>exp1 for py2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64 <span class="keyword">as</span> b64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">source_str = <span class="string">&#x27;heheda&#x27;</span> + <span class="number">10</span> * <span class="string">&#x27;\x0a&#x27;</span></span><br><span class="line">target_srt = <span class="string">&#x27;admin&#x27;</span> + <span class="number">11</span> * <span class="string">&#x27;\x0b&#x27;</span></span><br><span class="line">token = <span class="string">&#x27;eANhyUAiu6jfkh5CvDnkpQ==&#x27;</span> <span class="comment">#you got token</span></span><br><span class="line">token = <span class="built_in">list</span>(b64.b64decode(token))</span><br><span class="line"><span class="comment">#print(token)</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="built_in">len</span>(target_srt)):</span><br><span class="line">    token[x] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(token[x]) ^ <span class="built_in">ord</span>(target_srt[x]) ^ <span class="built_in">ord</span>(source_str[x]))</span><br><span class="line"><span class="built_in">print</span> token</span><br><span class="line"><span class="built_in">print</span> b64.b64encode(<span class="string">&#x27;&#x27;</span>.join(token))</span><br></pre></td></tr></table></figure>
<p>exp2 for py3</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64 <span class="keyword">as</span> b64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">source_str = <span class="string">&#x27;heheda&#x27;</span> + <span class="number">10</span> * <span class="string">&#x27;\x0a&#x27;</span></span><br><span class="line">target_srt = <span class="string">&#x27;admin&#x27;</span> + <span class="number">11</span> * <span class="string">&#x27;\x0b&#x27;</span></span><br><span class="line">token = <span class="string">&#x27;yxC20Pw32gbpCPjLc5qNRw==&#x27;</span> <span class="comment">#you got token</span></span><br><span class="line">token = <span class="built_in">bytearray</span>(b64.b64decode(token))</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(target_srt)):</span><br><span class="line">    token[x] = token[x] ^ <span class="built_in">ord</span>(target_srt[x]) ^ <span class="built_in">ord</span>(source_str[x])</span><br><span class="line"><span class="built_in">print</span>(b64.b64encode(token))</span><br><span class="line"></span><br><span class="line"><span class="comment">#cQJkxUpIuqnekx9DvTjlpA==</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-change-cipher-iv"><a href="#4-3-change-cipher-iv" class="headerlink" title="4.3.change cipher&amp;&amp;iv"></a>4.3.change cipher&amp;&amp;iv</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex,a2b_hex</span><br><span class="line">key=<span class="string">&quot;1234567890123456&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">iv,plaintext</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(plaintext)%<span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;plaintext length is invalid&quot;</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(iv) != <span class="number">16</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;IV length is invalid&quot;</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    aes_encrypt = AES.new(key,AES.MODE_CBC,IV=iv)</span><br><span class="line">    <span class="keyword">return</span> b2a_hex(aes_encrypt.encrypt(plaintext))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">iv,cipher</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(iv) != <span class="number">16</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;IV length is invalid&quot;</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    aes_decrypt = AES.new(key,AES.MODE_CBC,IV=iv)</span><br><span class="line">    <span class="keyword">return</span> b2a_hex(aes_decrypt.decrypt(a2b_hex(cipher)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    iv=<span class="string">&quot;ABCDEFGH12345678&quot;</span></span><br><span class="line">    plaintext=<span class="string">&quot;0123456789ABCDEFhelloyoucgetflag&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;plaintext:&quot;</span>+plaintext</span><br><span class="line">    cipher=encrypt(iv, plaintext)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;cipher:&quot;</span>+cipher</span><br><span class="line">    de_cipher = decrypt(iv, cipher)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;de_cipher:&quot;</span>+de_cipher</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;de_cipher:&quot;</span>+a2b_hex(de_cipher)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_cbc_15</span>():</span><br><span class="line">    iv=<span class="string">&quot;ABCDEFGH12345678&quot;</span></span><br><span class="line">    plaintext=<span class="string">&quot;0123456789ABCDEFhelloyoucgetflag&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;plaintext:&quot;</span>+plaintext</span><br><span class="line">    cipher=encrypt(iv, plaintext)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;cipher:&quot;</span>+cipher</span><br><span class="line">    bin_cipher = <span class="built_in">bytearray</span>(a2b_hex(cipher))</span><br><span class="line">    bin_cipher[<span class="number">15</span>] = bin_cipher[<span class="number">15</span>] ^ <span class="built_in">ord</span>(<span class="string">&#x27;g&#x27;</span>) ^ <span class="built_in">ord</span>(<span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">    de_cipher = decrypt(iv,b2a_hex(bin_cipher))</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;de_cipher2:&quot;</span>+de_cipher</span><br><span class="line">    <span class="built_in">print</span> a2b_hex(de_cipher)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_cbc_all</span>():</span><br><span class="line">    iv=<span class="string">&quot;ABCDEFGH12345678&quot;</span></span><br><span class="line">    plaintext=<span class="string">&quot;0123456789ABCDEFhelloyoucgetflag&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;plaintext:&quot;</span>+plaintext</span><br><span class="line">    cipher=encrypt(iv, plaintext)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;cipher:&quot;</span>+cipher</span><br><span class="line">    bin_cipher = <span class="built_in">bytearray</span>(a2b_hex(cipher))</span><br><span class="line">    bin_cipher[<span class="number">15</span>] = bin_cipher[<span class="number">15</span>] ^ <span class="built_in">ord</span>(<span class="string">&#x27;g&#x27;</span>) ^ <span class="built_in">ord</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    de_cipher = decrypt(iv,b2a_hex(bin_cipher))</span><br><span class="line">    bin_decipher = <span class="built_in">bytearray</span>(a2b_hex(de_cipher))</span><br><span class="line">    bin_iv = <span class="built_in">bytearray</span>(iv)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(iv)):</span><br><span class="line">        bin_iv[i] = bin_iv[i] ^ bin_decipher[i] ^ <span class="built_in">ord</span>(<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line">    de_cipher = decrypt(<span class="built_in">str</span>(bin_iv),b2a_hex(bin_cipher))</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;de_cipher3:&quot;</span>+de_cipher</span><br><span class="line">    <span class="built_in">print</span> a2b_hex(de_cipher)</span><br><span class="line">test_cbc_all();</span><br></pre></td></tr></table></figure>

<h2 id="5-CBC-Padding-Oracle"><a href="#5-CBC-Padding-Oracle" class="headerlink" title="5.CBC Padding Oracle"></a>5.CBC Padding Oracle</h2><h3 id="5-1-Q"><a href="#5-1-Q" class="headerlink" title="5.1.Q"></a>5.1.Q</h3><p>padding_serv.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">This server is a modified version of the previous one.</span></span><br><span class="line"><span class="string">This server will send you some data encrypted in CBC mode.</span></span><br><span class="line"><span class="string">You can request decryptions of ciphertexts. The server will tell you if your ciphertext</span></span><br><span class="line"><span class="string">decrypts to something with valid padding, but you won&#x27;t get the plaintext back.</span></span><br><span class="line"><span class="string">This is one of those obscure crypto implementation details that you can use to completely </span></span><br><span class="line"><span class="string">defeat the cryptosystem.</span></span><br><span class="line"><span class="string">The Secret is in the decrypted ciphertext. </span></span><br><span class="line"><span class="string">Good luck!</span></span><br><span class="line"><span class="string">Ciphertexts are sent back and forth as ASCII Encoded Hex Strings. 0xFF will be sent as </span></span><br><span class="line"><span class="string">&quot;FF&quot; (2 Bytes), not as &quot;\xff&quot; (1 Byte).</span></span><br><span class="line"><span class="string">You can use python&#x27;s string.encode(&#x27;hex&#x27;) and string.decode(&#x27;hex&#x27;) to quickly convert between</span></span><br><span class="line"><span class="string">raw data and string representation if you need/want to.</span></span><br><span class="line"><span class="string">Email biernp@rpi.edu with questions/comments :)</span></span><br><span class="line"><span class="string">-Patrick Biernat</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> twisted.internet <span class="keyword">import</span> reactor, protocol</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">PORT = <span class="number">9004</span></span><br><span class="line"></span><br><span class="line">KEYSIZE = <span class="number">16</span></span><br><span class="line">KEY = <span class="string">&quot;AAA&quot;</span> + <span class="string">&quot;BBB&quot;</span> + <span class="string">&quot;CCC&quot;</span> + <span class="string">&#x27;\x01&#x27;</span> + <span class="string">&quot;\x80&quot;</span> * <span class="number">6</span></span><br><span class="line">IV = os.urandom(<span class="number">16</span>)</span><br><span class="line">SECRET = <span class="string">&quot;A&quot;</span> * <span class="number">16</span> + <span class="string">&quot;d4t_!nf0_l34k_y0&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">instr, length</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	Generate valid PKCS#7 Padding</span></span><br><span class="line"><span class="string">	&#x27;&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">if</span>(length == <span class="literal">None</span>):</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&quot;Supply a length to pad to&quot;</span></span><br><span class="line">        <span class="keyword">elif</span>(<span class="built_in">len</span>(instr) &lt; length):</span><br><span class="line">                <span class="keyword">return</span> instr + <span class="built_in">chr</span>((length - <span class="built_in">len</span>(instr))) * (length - <span class="built_in">len</span>(instr))</span><br><span class="line">        <span class="keyword">elif</span>(<span class="built_in">len</span>(instr) % length == <span class="number">0</span>):</span><br><span class="line">                <span class="comment">#Add a block-length worth of padding. </span></span><br><span class="line">                <span class="keyword">return</span> instr + (<span class="built_in">chr</span>(length) * length)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> instr + <span class="built_in">chr</span>((length - (<span class="built_in">len</span>(instr) % length ))) * (length - (<span class="built_in">len</span>(instr) % length ))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_padding</span>(<span class="params">instr</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Determine if valid PKCS#7 Padding is present in instr.</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">#Grab the last byte of instr.</span></span><br><span class="line">        length = instr[-<span class="number">1</span>]</span><br><span class="line"><span class="comment">#       print length.encode(&#x27;hex&#x27;)</span></span><br><span class="line">        test = instr[-<span class="number">1</span> * <span class="built_in">int</span>(length.encode(<span class="string">&#x27;hex&#x27;</span>),<span class="number">16</span>):]</span><br><span class="line">        test = test.replace(length,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> (test != <span class="string">&quot;&quot;</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_block</span>(<span class="params">key, plaintext</span>):</span><br><span class="line">        encobj = AES.new(key, AES.MODE_ECB)</span><br><span class="line">        <span class="keyword">return</span> encobj.encrypt(plaintext).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_block</span>(<span class="params">key, ctxt</span>):</span><br><span class="line">        decobj = AES.new(key, AES.MODE_ECB)</span><br><span class="line">        <span class="keyword">return</span> decobj.decrypt(ctxt).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_block</span>(<span class="params">first,second</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Return a string containing a XOR of bytes in first with second</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(first) != <span class="built_in">len</span>(second)):</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&quot;Blocks need to be the same length!&quot;</span></span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        first = <span class="built_in">list</span>(first)</span><br><span class="line">        second = <span class="built_in">list</span>(second)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(first)):</span><br><span class="line">                first[i] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(first[i]) ^ <span class="built_in">ord</span>(second[i]))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(first)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_cbc</span>(<span class="params">key,IV, plaintext</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        High Level Function to encrypt things in AES CBC Mode.</span></span><br><span class="line"><span class="string">        1: Pad plaintext if necessary. </span></span><br><span class="line"><span class="string">        2: Split plaintext into blocks of length &lt;keysize&gt;</span></span><br><span class="line"><span class="string">        3: XOR Block 1 w/ IV</span></span><br><span class="line"><span class="string">        4: Encrypt Blocks, XOR-ing them w/ the previous block. </span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(plaintext) % <span class="built_in">len</span>(key) != <span class="number">0</span>):</span><br><span class="line">                plaintext = pad(plaintext,<span class="built_in">len</span>(key))</span><br><span class="line">        blocks = [plaintext[x:x+<span class="built_in">len</span>(key)] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(plaintext),<span class="built_in">len</span>(key))]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(blocks)):</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>):</span><br><span class="line">                        ctxt = xor_block(blocks[i],<span class="string">&quot;\x00&quot;</span>* <span class="number">16</span>)</span><br><span class="line">                        ctxt = encrypt_block(key,ctxt)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                        tmp = xor_block(blocks[i],ctxt[-<span class="number">1</span> * (<span class="built_in">len</span>(key) * <span class="number">2</span>):].decode(<span class="string">&#x27;hex&#x27;</span>))     <span class="comment">#len(key) * 2 because ctxt is an ASCII string that we convert to &quot;raw&quot; binary.          </span></span><br><span class="line"></span><br><span class="line">                        ctxt = ctxt + encrypt_block(key,tmp)</span><br><span class="line">        <span class="keyword">return</span> ctxt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_cbc</span>(<span class="params">key,IV,ctxt</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;High Level function to decrypt thins in AES CBC mode.</span></span><br><span class="line"><span class="string">        1: Split Ciphertext into blocks of len(Key)</span></span><br><span class="line"><span class="string">        2: Decrypt block.</span></span><br><span class="line"><span class="string">        3: For the first block, xor w/ IV. For the others, xor with last ciphertext block.</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        ctxt = ctxt.decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(ctxt) % <span class="built_in">len</span>(key) != <span class="number">0</span>):</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&quot;Invalid Key.&quot;</span></span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        blocks = [ctxt[x:x+<span class="built_in">len</span>(key)] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(ctxt),<span class="built_in">len</span>(key))]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(blocks)):</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>):</span><br><span class="line">                        ptxt = decrypt_block(key,blocks[i])</span><br><span class="line">                        ptxt = xor_block(ptxt.decode(<span class="string">&#x27;hex&#x27;</span>),IV)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                        tmp = decrypt_block(key,blocks[i])</span><br><span class="line">                        tmp = xor_block(tmp.decode(<span class="string">&#x27;hex&#x27;</span>),blocks[i-<span class="number">1</span>])</span><br><span class="line">                        ptxt = ptxt + tmp</span><br><span class="line">        <span class="keyword">return</span> ptxt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding_check</span>(<span class="params">data</span>):</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;DATA:&quot;</span></span><br><span class="line">	<span class="built_in">print</span> data	</span><br><span class="line">	<span class="built_in">print</span> decrypt_cbc(KEY,IV,data)</span><br><span class="line">	<span class="keyword">return</span> valid_padding(decrypt_cbc(KEY,IV,data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_your_ctxt</span>():</span><br><span class="line">	<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	This will return the Secret String that you need to decrypt.</span></span><br><span class="line"><span class="string">	&#x27;&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">return</span> encrypt_cbc(KEY,IV,pad(SECRET,<span class="built_in">len</span>(KEY)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyServer</span>(protocol.Protocol):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dataReceived</span>(<span class="params">self,data</span>):</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">len</span>(data) &gt; <span class="number">512</span>):</span><br><span class="line">		self.transport.write(<span class="string">&quot;Data too long.\n&quot;</span>)</span><br><span class="line">		self.transport.loseConnection()</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line"><span class="comment">#Make Profile From &quot;Email&quot;</span></span><br><span class="line">	<span class="keyword">if</span>(data.startswith(<span class="string">&quot;get:&quot;</span>)):</span><br><span class="line">		resp = get_your_ctxt()</span><br><span class="line">		<span class="keyword">if</span> (resp == -<span class="number">1</span>):</span><br><span class="line">			self.transport.write(<span class="string">&quot;No Cheating!\n&quot;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			self.transport.write(resp)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Decrypt Ciphertext and &quot;parse&quot; into Profile</span></span><br><span class="line">	<span class="keyword">elif</span>(data.startswith(<span class="string">&quot;parse:&quot;</span>)):</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;PARSING&quot;</span></span><br><span class="line">		data = data[<span class="number">6</span>:]</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">len</span>(data) % KEYSIZE != <span class="number">0</span>):</span><br><span class="line">			<span class="built_in">print</span> <span class="string">&quot;BAD CIPHERTEXT&quot;</span></span><br><span class="line">			self.transport.write(<span class="string">&quot;Invalid Ciphertext &lt;length&gt;\n&quot;</span>)</span><br><span class="line">			self.transport.loseConnection()</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(padding_check(data) == <span class="literal">True</span>):</span><br><span class="line">			self.transport.write(<span class="string">&quot;VALID PADDING&quot;</span>)</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			self.transport.write(<span class="string">&quot;INVALID PADDING&quot;</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		self.transport.write(<span class="string">&quot;Syntax Error&quot;</span>)</span><br><span class="line">		self.transport.loseConnection()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyServerFactory</span>(protocol.Factory):</span><br><span class="line">    protocol = MyServer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">factory = MyServerFactory()</span><br><span class="line">reactor.listenTCP(PORT, factory)</span><br><span class="line">reactor.run()</span><br></pre></td></tr></table></figure>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2num</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(s.encode(<span class="string">&#x27;hex&#x27;</span>),<span class="number">16</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">num2str</span>(<span class="params">n</span>):</span><br><span class="line">    d = (<span class="string">&#x27;%x&#x27;</span> % n)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(d) % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        d = <span class="string">&#x27;0&#x27;</span> + d</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">j,z</span>):</span><br><span class="line">    x = <span class="string">&quot;00&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line">        y = <span class="string">&quot;parse:&quot;</span>+<span class="string">&quot;00&quot;</span>*j + x + z+<span class="string">&quot;ef2c6db9d0bc134f752a119899160b72&quot;</span></span><br><span class="line">        client.send(y)</span><br><span class="line">        data = client.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> data == <span class="string">&quot;VALID PADDING&quot;</span>:</span><br><span class="line">           <span class="comment"># print i, hex(i)</span></span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        x = <span class="built_in">int</span>(x, <span class="number">16</span>) + <span class="number">1</span></span><br><span class="line">        x = num2str(x)</span><br><span class="line"></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">9004</span>))</span><br><span class="line"></span><br><span class="line">client.send(<span class="string">&quot;get:AAAAAAA&quot;</span>)</span><br><span class="line">data = client.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span> data</span><br><span class="line"></span><br><span class="line">client.send(<span class="string">&quot;parse:f9b6e7556dd0fa9038ac346e849cc5c1ef2c6db9d0bc134f752a119899160b7217a36290f3ed054ca48f1b052578b644&quot;</span>)</span><br><span class="line">data = client.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span> data</span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span> = <span class="number">16</span></span><br><span class="line">j = <span class="number">15</span></span><br><span class="line">k = <span class="number">1</span></span><br><span class="line">tmp = <span class="string">&quot;01&quot;</span> <span class="comment"># from 1 to \x10</span></span><br><span class="line">string_s = <span class="string">&quot;&quot;</span></span><br><span class="line">string_mid = <span class="string">&quot;&quot;</span></span><br><span class="line">z = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">sum</span>):</span><br><span class="line">    confir = num2str(func(j,z))</span><br><span class="line">   <span class="comment"># print confir</span></span><br><span class="line">    string_s = <span class="built_in">str</span>(confir) </span><br><span class="line">    <span class="comment">#print &quot;string_s:&quot;+string_s</span></span><br><span class="line">    <span class="comment">#print &quot;string_mid:&quot;+string_mid</span></span><br><span class="line">    <span class="comment">#print tmp*k</span></span><br><span class="line">    string_mid = <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(string_s,<span class="number">16</span>)^<span class="built_in">int</span>(tmp,<span class="number">16</span>)))+string_mid</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;string_mid:&quot;</span> + string_mid</span><br><span class="line">    tmp = <span class="built_in">int</span>(tmp, <span class="number">16</span>) + <span class="number">1</span></span><br><span class="line">    tmp = num2str(tmp)</span><br><span class="line">    string_mid = string_mid[<span class="number">2</span>:].replace(<span class="string">&#x27;L&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(string_mid)%<span class="number">2</span> !=<span class="number">0</span>:</span><br><span class="line">    string_mid = <span class="string">&quot;0&quot;</span>+string_mid</span><br><span class="line">    <span class="comment">#print string_mid</span></span><br><span class="line">    <span class="comment">#print tmp</span></span><br><span class="line">    temp = <span class="built_in">len</span>(z)+<span class="number">3</span></span><br><span class="line"></span><br><span class="line">    z = <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(string_mid,<span class="number">16</span>)^<span class="built_in">int</span>(tmp*k,<span class="number">16</span>)))</span><br><span class="line">    z = z[<span class="number">2</span>:].replace(<span class="string">&#x27;L&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> temp == <span class="built_in">len</span>(<span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(string_mid,<span class="number">16</span>)^<span class="built_in">int</span>(tmp*k,<span class="number">16</span>)))):</span><br><span class="line">    z = <span class="string">&quot;00&quot;</span> + z</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(z)%<span class="number">2</span> !=<span class="number">0</span>:</span><br><span class="line">    z = <span class="string">&quot;0&quot;</span>+z</span><br><span class="line">    <span class="comment">#print &quot;z:&quot;+z</span></span><br><span class="line">    j = j-<span class="number">1</span></span><br><span class="line">    k = k+<span class="number">1</span></span><br><span class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span>-<span class="number">1</span></span><br><span class="line"><span class="comment">#func(j,z)</span></span><br><span class="line"></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Some-Symmetric-Encryption-Algorithm"><span class="toc-number">1.</span> <span class="toc-text">1. Some Symmetric Encryption Algorithm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Symmetric-Cryptography-in-CTF-WEB"><span class="toc-number">2.</span> <span class="toc-text">2. Symmetric Cryptography in CTF-WEB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Some-Encryption-mode"><span class="toc-number">3.</span> <span class="toc-text">3. Some Encryption mode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Electronic-Codebook-Book-ECB"><span class="toc-number">3.1.</span> <span class="toc-text">3.1. Electronic Codebook Book (ECB)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Cipher-Block-Chaining-CBC"><span class="toc-number">3.2.</span> <span class="toc-text">3.2. Cipher Block Chaining (CBC)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-CBC-Byte-Flipping-Attack"><span class="toc-number">4.</span> <span class="toc-text">4.CBC Byte Flipping Attack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-Working-Principle"><span class="toc-number">4.1.</span> <span class="toc-text">4.1.Working Principle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-For-example-if-we-can-change-iv"><span class="toc-number">4.2.</span> <span class="toc-text">4.2.For example if we can change iv</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-Question-of-only-change-iv"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.2.1.Question of only change iv</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-change-cipher-iv"><span class="toc-number">4.3.</span> <span class="toc-text">4.3.change cipher&amp;&amp;iv</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-CBC-Padding-Oracle"><span class="toc-number">5.</span> <span class="toc-text">5.CBC Padding Oracle</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Q"><span class="toc-number">5.1.</span> <span class="toc-text">5.1.Q</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&text=Some Tricks of Symmetric Cryptography"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&title=Some Tricks of Symmetric Cryptography"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&is_video=false&description=Some Tricks of Symmetric Cryptography"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Some Tricks of Symmetric Cryptography&body=Check out this article: http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&title=Some Tricks of Symmetric Cryptography"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&title=Some Tricks of Symmetric Cryptography"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&title=Some Tricks of Symmetric Cryptography"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&title=Some Tricks of Symmetric Cryptography"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&name=Some Tricks of Symmetric Cryptography&description=&lt;p&gt;Symmetric Cryptography means this encryption algorithm use the same key for encryption and decryption. Although I am a web dog, encryption algorithm in some web question recently let me broken heart.&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/&t=Some Tricks of Symmetric Cryptography"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    Bkfish
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
